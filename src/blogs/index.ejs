<% 
  getBlogs = function() { 
    const blogFolderAbs = path.resolve(dirname())
    const ls = readDir(blogFolderAbs)
    const blogs = []

    for (const itemName of ls) {
      const itemPathAbs = path.join(blogFolderAbs, itemName)
      if (itemName.startsWith('_')) continue
      if (!stat(itemPathAbs).isDirectory()) continue
      const meta = parseYaml(readFile(path.join(itemPathAbs, 'meta.yaml')))
      blogs.push({ slug: itemName, ...meta })
    }

    blogs.sort((a,b) => new Date(b.publish_date) - new Date(a.publish_date))

    return blogs
  }
%>

<!DOCTYPE html>
<html lang="en">
<head>
  <% include('../_partials/meta'); -%>
  <%- includeStyle('../style.scss') %>
  <title>Document</title>
</head>
<body>
  List of blogs!

  <% for (const entry of getBlogs()) { %>
    <div>
      <%= entry.title %> <br>
      <%= entry.publish_date %><br>
      <a href="<%= entry.slug %>"><%= entry.title %></a>
      <br><br><br>
    </div>
  <% } %>
</body>
</html>