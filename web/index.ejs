<%
  includeStyle = requireModule('./_require/include-style.ts').includeStyle
  getPosts = requireModule('./_require/get-posts.ts').getPosts
  prettyDate = requireModule('./_require/pretty-date.ts').prettyDate

  includeDir('./assets')
  includeFile('./robots.txt')
  includeFile('./manifest.json')

  postsDetails = getPosts(locals)
%>
<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./_partials/analytics.ejs'); -%>
  <%- include('./_partials/meta'); -%>
  <%- include('./_partials/links'); -%>
  <%- includeStyle(locals, './style.scss'); -%>
  <%- include('./_partials/dark-mode'); -%>
  <meta property="og:url"                content="https://davidalsh.com" />
  <meta property="og:type"               content="website" />
  <meta property="og:title"              content="David Alsh - Software Engineering Articles, Videos, Tutorials and More" />
  <meta property="og:description"        content="My personal website where I share my thoughts and expereinces, like and subscribe!" />
  <meta property="og:image"              content="https://davidalsh.com/assets/share.jpeg" />
  <title>David Alsh - Home</title>
</head>
<body class="page-home">
  <%- include('./_partials/nav'); -%>
  <main class="content-max-width framed markdown grow">
    <div class="filter" id="filter">
      <span>Categories</span>
      <button class="unselectable" onclick="filterByTags([])">All</button>
      <button onclick="filterByTags(['article'])">Articles</button>
      <button onclick="filterByTags(['video'])">Videos</button>
      <button onclick="filterByTags(['tutorial'])">Tutorials</button>
    </div>
    <% for (const post of postsDetails.posts) { %>
    <article data-tags="<%= post.tags.join(' ') %>">
      <a href="/posts/<%= post.slug %>/">
        <div class="article-content">
          <h2><%= post.title %></h2>
          <div class="post-meta">
            <time datetime="<%= post.publish_date %>"><%= prettyDate(post.publish_date) %></time>
            <% for (const tag of post.tags) { %>
            <span><%= tag %></span>
            <% } %>
          </div>
          <p><%= post.preview %></p>
        </div>
        <div class="image">
          <img src="/posts/<%= post.slug %>/<%= post.image %>" alt="<%= post.image_alt %>">
        </div>
      </a>
    </article>
    <% } %>
  </main>
  <script type="module">
    function filterByTags(tags) {
      const articles = document.querySelectorAll('article')
      if (tags.length === 0) {
        for (const article of articles) {
          article.style.display = null
        }
        return
      }
      for (const article of articles) {
        const articleTags = article.getAttribute('data-tags')
        let found = false

        for (const tag of tags) {
          if (articleTags.includes(tag)) {
            found = true
            break
          }
        }

        if (found) {
          article.style.display = null
        } else {
          article.style.display = 'none'
        }
      }
    }

    const filterEl = document.querySelector('#filter')
    const filterButtonEls = filterEl.querySelectorAll('button')

    filterEl.addEventListener('click', e => {
      for(const filterButtonEl of filterButtonEls) {
        if (filterButtonEl === e.target) continue
        filterButtonEl.classList.remove('selected')
      }
      e.target.classList.add('selected')
    })

    window.filterByTags = filterByTags
  </script>
</body>
</html>
